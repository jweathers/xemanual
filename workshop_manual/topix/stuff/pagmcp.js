function Pagmcp(elm){var pagmcp=this;var urlPrefix="http://localhost:8080";var callTimeout=null;var sddVersion=null;var element=$(elm);var button=null;pagmcp.sddVersion=null;pagmcp.sddResult=null;var init=function(){var div=$('<div class="steps pagmcp-hide-print pagmcp-button" width="100%">    <div style="overflow: visible;">        <a class="pagmcp-hide-print pagmcp disabled pagmcp-button" style="display:none" href="#">Loading PAGMCP...</a>        <span class="pagmcp-hide-print showManualSteps" style="display:none">            '+i18nMessages.xsl_odyssey_pagmcp_showManualSteps+"        </span>    </div></div>");element.prepend(div);button=$("a.pagmcp-button",element);versionCheck()};var sendJsonRequest=function(jsonUrl){var head=document.getElementsByTagName("head").item(0),completeURL=urlPrefix+jsonUrl,oscript;oscript=document.createElement("script");oscript.type="text/javascript";oscript.src=completeURL;head.appendChild(oscript)};var noSddDetected=function(){button.addClass("disabled").hide()};var handleVersion=function(data){data=eval("("+data+")");if(callTimeout!==null){clearTimeout(callTimeout)}pagmcp.sddVersion=data.sddVersion;if(element.attr("data-version")>data.sddVersion){button.addClass("disabled").text(element.attr("data-buttontext")+" ("+i18nMessages.xsl_odyssey_pagmcp_versionMismatch+": "+element.attr("data-version")+")").show();$(".mixed-list:not(.pagmcp-button)",element).show();$(".showManualSteps",element).hide()}else{button.removeClass("disabled").text(element.attr("data-buttontext")).click(launchSdd).show();(function(){var steps=$(".mixed-list:not(.pagmcp-button)",element).addClass("pagmcp-hide-steps"),toggleButton=$(".showManualSteps",element).click(toggleManualSteps);if(steps.size()>0){toggleButton.show()}else{toggleButton.hide()}})();$(window).resize()}};var versionCheck=function(){var candidateNo=element.attr("data-candidatenum"),url="/versionCheck.action?callback=window.handleVersion"+candidateNo;window["handleVersion"+candidateNo]=handleVersion;callTimeout=window.setTimeout(function(){noSddDetected()},2000);sendJsonRequest(url)};var sessionNotLaunched=function(){button.addClass("disabled").text(i18nMessages.xsl_odyssey_pagmcp_launchFailure)};var launchAck=function(data){if(callTimeout!==null){clearTimeout(callTimeout)}window.launchAck=null;pagmcp.sddResult=data.sddResult;button.addClass("disabled").text(pagmcp.sddResult)};var launchedDirectFromTopix=function(){try{if(window.parent.location.href.indexOf("")>1){}}catch(err){return false}return true};function getFromReportCandidateId(){var fromReportCandidateId=window.parent.globalReferenceNumber;if(typeof(fromReportCandidateId)=="undefined"){fromReportCandidateId=window.parent.parent.globalReferenceNumber}return fromReportCandidateId}function getFromReportCandidateUri(){var link;try{link=window.parent.parent.location.href}catch(err){link=window.parent.location.href}return link}var launchSdd=function(ev){var launchedFromTopix=launchedDirectFromTopix(),vehicleId=element.attr("data-vin"),sessionId=element.attr("data-sessionId"),candidateId=element.attr("data-candidatenum"),bulletinsView=window.parent.$("#bulletinsView").val(),url,action,fromReportCandidateUri;ev.preventDefault();if(launchedFromTopix){fromReportCandidateUri=getFromReportCandidateUri();action="/gateway_connected.action"}else{fromReportCandidateUri=window.location.href;action="/launchTopixPagmcp.action"}if(fromReportCandidateUri.indexOf("&pagmcpCategory=bulletins")==-1){fromReportCandidateUri+="&pagmcpCategory=bulletins"}if(typeof($.url(fromReportCandidateUri).param("fsaComponentType"))==="undefined"){var fsaComponentType=$.url($(this).attr("href")).param("fsaComponentType");if(typeof(fsaComponentType)!=="undefined"){fromReportCandidateUri+="&fsaComponentType="+fsaComponentType}}var indexOfHash=fromReportCandidateUri.indexOf("#");if(indexOfHash===-1){fromReportCandidateUri+="#"+candidateId}else{fromReportCandidateUri=fromReportCandidateUri.substring(0,indexOfHash)+"#"+candidateId}url=urlPrefix+action+"?pagmcpCandidateId="+encodeURIComponent(candidateId)+"&fromReportCandidateId="+encodeURIComponent(getFromReportCandidateId())+"&fromReportCandidateUri="+encodeURIComponent(fromReportCandidateUri)+"&vinNumber="+encodeURIComponent(vehicleId)+"&launchedDirectFromTopix="+encodeURIComponent(launchedFromTopix)+"&bulletinsView="+encodeURIComponent(bulletinsView);button.addClass("disabled");if(launchedFromTopix){parent.location.href=url}else{window.location.href=url}};var toggleManualSteps=function(){var showing=!$(".mixed-list:not(.pagmcp-button)",element).toggleClass("pagmcp-hide-steps").hasClass("pagmcp-hide-steps");$(this).text(showing?i18nMessages.xsl_odyssey_pagmcp_hideManualSteps:i18nMessages.xsl_odyssey_pagmcp_showManualSteps)};init()}$(function(){var a=$("div.pagmcp[data-vin]").not('[data-vin=""]');$.each(a,function(){$(this).data("pagmcp",new Pagmcp(this))});$(window).resize(focusPagmcpLink).resize()});function focusPagmcpLink(){var c;try{c=window.parent.parent.location.hash}catch(b){c=window.parent.location.hash}if(c!=""){if(c.length>1){var a=$("#"+c.substring(1,c.indexOf("!")===-1?c.length:c.indexOf("!")));if(a.length){window.scrollTo(0,0);setTimeout(function(){$(window).off("resize.pagmcp-focus-link")},1000);window.scrollTo(0,a.position().top)}}}};